<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSC 26 | Section B | The Reel</title>
    
    <!-- TYPOGRAPHY -->
    <link href="https://api.fontshare.com/v2/css?f[]=alpino@300,400,500,700&f[]=clash-display@400,500,600,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tiro+Bangla:ital@0;1&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <!-- TAILWIND -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        archive: '#0f0e0d',
                        paper: '#e8e6e1',   
                        sepia: '#cbb69d',
                        gold: '#d4af37',
                    },
                    fontFamily: {
                        sans: ['Alpino', 'sans-serif'],
                        display: ['Clash Display', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                        bangla: ['Tiro Bangla', 'serif'],
                    },
                    cursor: {
                        none: 'none',
                    }
                }
            }
        }
    </script>

    <!-- STYLES -->
    <style>
        :root { --archive: #0f0e0d; --paper: #e8e6e1; }
        body {
            background-color: var(--archive);
            color: var(--paper);
            margin: 0;
            cursor: none;
            -webkit-font-smoothing: antialiased;
        }

        /* The Card Style */
        .polaroid {
            will-change: transform;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.4s ease;
            transform-style: preserve-3d;
        }
        .polaroid:hover {
            z-index: 50;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* Tape Effect */
        .tape {
            background-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            backdrop-filter: blur(2px);
            transform: rotate(-2deg);
        }

        /* Back Button Magnetic Zone */
        .magnetic-wrap {
            display: inline-block;
            position: relative;
        }

        /* Custom Cursor */
        .cursor-dot, .cursor-outline {
            position: fixed; top: 0; left: 0;
            transform: translate(-50%, -50%);
            border-radius: 50%; z-index: 9998; pointer-events: none;
        }
        .cursor-dot { width: 6px; height: 6px; background-color: var(--gold); }
        .cursor-outline { width: 40px; height: 40px; border: 1px solid rgba(232, 230, 225, 0.5); transition: all 0.2s; }
        
        @media (pointer: coarse) {
            body { cursor: auto; }
            .cursor-dot, .cursor-outline { display: none; }
        }

        /* Lenis */
        html.lenis { height: auto; }
        .lenis.lenis-smooth { scroll-behavior: auto !important; }
        .lenis.lenis-smooth [data-lenis-prevent] { overscroll-behavior: contain; }
        .lenis.lenis-stopped { overflow: hidden; }

        /* Loader */
        .loader-screen {
            position: fixed; inset: 0; background: var(--archive); z-index: 10000;
            display: flex; justify-content: center; align-items: center;
        }
    </style>

    <!-- LIBRARIES -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script type="module" src="https://unpkg.com/@studio-freight/lenis@1.0.29/dist/lenis.min.js"></script>
</head>
<body class="selection:bg-gold selection:text-archive" data-barba="wrapper">

    <!-- AUDIO PLAYER -->
    <audio id="bg-music" loop preload="auto">
        <source src="../music/reel.mp3" type="audio/mpeg">
    </audio>

    <!-- LOADER -->
    <div class="loader-screen">
        <div class="text-center">
            <span class="block font-display text-4xl mb-2 text-gold">Loading Reel</span>
            <div class="w-32 h-[1px] bg-paper/20 mx-auto overflow-hidden">
                <div class="w-full h-full bg-gold -translate-x-full animate-[shimmer_1.5s_infinite]"></div>
            </div>
        </div>
    </div>

    <!-- CURSOR -->
    <div class="cursor-dot"></div>
    <div class="cursor-outline"></div>

    <!-- NOISE -->
    <div class="fixed inset-0 z-0 pointer-events-none opacity-[0.05] mix-blend-overlay bg-[url('https://grainy-gradients.vercel.app/noise.svg')]"></div>

    <!-- NAVIGATION (The Magnetic Back Button) -->
    <nav class="fixed top-8 left-8 z-50 mix-blend-difference">
        <a href="gallery.html" class="magnetic-wrap group cursor-pointer block">
            <div class="btn-circle w-16 h-16 rounded-full border border-paper/30 flex items-center justify-center group-hover:bg-paper group-hover:border-paper transition-colors duration-300">
                <!-- Arrow Icon -->
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="text-paper group-hover:text-archive transition-colors duration-300 transform group-hover:-translate-x-1 group-hover:scale-90">
                    <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <span class="absolute left-20 top-1/2 -translate-y-1/2 text-xs font-mono uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap text-paper">
                Back to Portal
            </span>
        </a>
    </nav>

    <!-- HEADER -->
    <header class="pt-32 pb-16 px-6 md:px-12 text-center relative z-10">
        <span class="block font-mono text-xs uppercase tracking-[0.3em] text-gold mb-4 opacity-0 reveal-header">Photographic Memory</span>
        <h1 class="font-display text-[15vw] md:text-[8vw] leading-[0.8] opacity-0 reveal-header">
            The <span class="text-transparent" style="-webkit-text-stroke: 1px #e8e6e1;">Reel</span>
        </h1>
        <p class="mt-8 font-serif italic text-lg opacity-60 max-w-md mx-auto reveal-header opacity-0">
            A visual timeline of faces and moments.
        </p>
    </header>

    <!-- MAIN GRID -->
    <main class="relative z-10 px-4 md:px-12 pb-32">
        <!-- The Grid Container -->
        <div id="gallery-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-8 gap-y-24 w-full max-w-[1600px] mx-auto">
            <!-- Cards will be injected here via JS -->
        </div>
    </main>

    <!-- LOGIC -->
    <script type="module">
        import Lenis from 'https://cdn.jsdelivr.net/npm/@studio-freight/lenis@1.0.29/+esm';

        // 1. AUDIO HANDLER
        function initAudio() {
            const audio = document.getElementById('bg-music');
            if (!audio) return;
            
            audio.volume = 0.5; // Start at 50% volume

            // Attempt to play immediately
            const playPromise = audio.play();

            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    const startAudio = () => {
                        audio.play();
                        document.removeEventListener('click', startAudio);
                    };
                    document.addEventListener('click', startAudio);
                });
            }
        }

        // 2. DATA FETCHING
        async function loadGallery() {
            try {
                // Assuming gallery-data.json exists or is served relative to this file
                const response = await fetch('gallery-data.json');
                const students = await response.json();
                renderCards(students);
            } catch (error) {
                console.error("Failed to load archive:", error);
                // Fallback / Placeholder logic if JSON fails
                renderCards([]); 
            }
        }

        // 3. RENDER CARDS
        function renderCards(students) {
            const container = document.getElementById('gallery-grid');
            const placeholderRolls = Array.from({length: 88}, (_, i) => 101 + i); 
            
            const knownData = {};
            if(students) students.forEach(s => knownData[s.roll] = s);

            placeholderRolls.forEach((roll, index) => {
                const student = knownData[roll];
                
                const data = {
                    roll: roll,
                    tagLabel: "SEC B", 
                    desc: student ? (student.tag || "Student") : "Student",
                    quote: student ? (student.quote || "...") : "...",
                    link: student ? student.link : `students/${roll}.html`,
                    image: student ? student.image : ""
                };
                
                const rotation = (Math.random() - 0.5) * 6; 
                const tapeRotation = (Math.random() - 0.5) * 20;
                const delay = index * 0.02; 

                let visualContent;
                if (data.image && data.image.trim() !== "") {
                    visualContent = `
                        <img src="${data.image}" loading="lazy" class="w-full h-full object-cover sepia-[.3] brightness-[0.9] contrast-[1.1] saturate-[0.8] group-hover:sepia-0 group-hover:brightness-100 group-hover:contrast-100 group-hover:saturate-100 transition-all duration-500" alt="Student ${data.roll}">
                        <div class="absolute inset-0 bg-yellow-900/10 mix-blend-overlay group-hover:bg-transparent transition-all duration-300"></div>
                    `;
                } else {
                    visualContent = `
                        <span class="font-display text-[8rem] text-white/5 font-bold absolute select-none pointer-events-none">${data.roll}</span>
                        <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"></div>
                    `;
                }

                const card = document.createElement('div');
                card.className = 'polaroid-wrapper relative group opacity-0 translate-y-8';
                card.style.transitionDelay = `${Math.min(delay, 0.5)}s`;
                
                card.innerHTML = `
                    <div class="polaroid bg-[#1a1816] p-4 pb-8 shadow-2xl relative transform transition-all duration-500 group-hover:scale-105 group-hover:z-10 group-hover:bg-[#252220]"
                         style="transform: rotate(${rotation}deg);">
                        
                        <div class="tape absolute -top-3 left-1/2 -translate-x-1/2 w-24 h-8 bg-white/10 opacity-50" 
                             style="transform: translateX(-50%) rotate(${tapeRotation}deg);"></div>

                        <div class="aspect-[4/5] bg-[#0f0e0d] mb-4 relative overflow-hidden flex items-center justify-center border border-white/5">
                            ${visualContent}
                            
                            <div class="absolute inset-0 bg-gold/90 translate-y-full group-hover:translate-y-0 transition-transform duration-300 flex flex-col items-center justify-center p-4 text-center z-20">
                                <span class="font-mono text-xs text-archive mb-2 uppercase tracking-widest">Quote</span>
                                <p class="font-bangla text-archive text-lg leading-tight">"${data.quote}"</p>
                                <a href="${data.link}" class="mt-4 px-4 py-2 border border-archive text-archive text-xs uppercase tracking-widest hover:bg-archive hover:text-gold transition-colors">
                                    Open File
                                </a>
                            </div>
                        </div>

                        <div class="flex justify-between items-end border-b border-white/10 pb-2 mb-2">
                            <span class="font-display text-3xl text-paper">${data.roll}</span>
                            <span class="font-mono text-[10px] text-gold uppercase tracking-widest opacity-80">${data.tagLabel}</span>
                        </div>
                        <p class="font-serif italic text-sm opacity-60 line-clamp-2 min-h-[2.5em]">${data.desc}</p>
                    </div>
                `;
                container.appendChild(card);
            });

            revealUI();
        }

        // 4. ANIMATIONS
        function revealUI() {
            const tl = gsap.timeline();

            tl.to('.loader-screen', { yPercent: -100, duration: 1, ease: "expo.inOut" });

            tl.to('.reveal-header', { 
                y: 0, 
                opacity: 1, 
                duration: 1, 
                stagger: 0.1, 
                ease: "power3.out" 
            }, "-=0.5");

            tl.add(() => {
                document.querySelectorAll('.polaroid-wrapper').forEach(card => {
                    card.classList.remove('opacity-0', 'translate-y-8');
                });
            }, "-=0.5");
        }

        // 5. MOUSE/SCROLL LOGIC
        function initApp() {
            initAudio();

            const lenis = new Lenis({ lerp: 0.08, smooth: true });
            function raf(time) { lenis.raf(time); requestAnimationFrame(raf); }
            requestAnimationFrame(raf);

            // Magnetic Button logic
            const magneticBtn = document.querySelector('.magnetic-wrap');
            if (magneticBtn) {
                const circle = magneticBtn.querySelector('.btn-circle');
                
                magneticBtn.addEventListener('mousemove', (e) => {
                    const rect = magneticBtn.getBoundingClientRect();
                    const x = e.clientX - rect.left - rect.width / 2;
                    const y = e.clientY - rect.top - rect.height / 2;
                    gsap.to(magneticBtn, { x: x * 0.3, y: y * 0.3, duration: 0.3 });
                    gsap.to(circle, { x: x * 0.2, y: y * 0.2, duration: 0.3 });
                });

                magneticBtn.addEventListener('mouseleave', () => {
                    gsap.to([magneticBtn, circle], { x: 0, y: 0, duration: 0.5, ease: "elastic.out(1, 0.3)" });
                });
            }

            // Cursor Logic
            if (!window.matchMedia("(pointer: coarse)").matches) {
                const dot = document.querySelector('.cursor-dot');
                const outline = document.querySelector('.cursor-outline');
                
                window.addEventListener('mousemove', (e) => {
                    const x = e.clientX;
                    const y = e.clientY;
                    dot.style.transform = `translate(${x}px, ${y}px) translate(-50%, -50%)`;
                    gsap.to(outline, { x: x, y: y, duration: 0.15 });
                });

                const interactables = document.querySelectorAll('a, .polaroid');
                interactables.forEach(el => {
                    el.addEventListener('mouseenter', () => {
                        gsap.to(outline, { scale: 1.5, borderColor: '#d4af37' });
                    });
                    el.addEventListener('mouseleave', () => {
                        gsap.to(outline, { scale: 1, borderColor: 'rgba(232,230,225,0.5)' });
                    });
                });
            }
        }

        initApp();
        loadGallery();

    </script>
</body>
</html>